<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="bower_components/jquery-ui/themes/overcast/jquery-ui.css"/>

    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto);

        html, body, main, input, label, div {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #f5f5f5;
            background-image: url("/assets/alltherooms.jpg");
            background-size: 100%;
        }
        main {
            display: -webkit-flex;
            display: flex;
            -webkit-flex-flow: row wrap;
            flex-flow: row wrap;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-justify-content: flex-end;
            justify-content: center;

            font-size: 2em;
            padding: 0.5em 0;

            border-radius: 10px 10px 0 0;
            border-style: solid;
            border-color: #ffffff;
            margin-bottom: 5%;
            margin: 0 10%;
            background-color: #f0ecec;
        }
        #wrapper {
            font-weight: 300;
            font-size: 2em;
            font-family: Roboto;
            margin: 0.5em 0.25em;
            display: inline-block;
            color: #212121;
            padding: 5%;
            width: 100%;

            display: flex;
            flex-wrap: wrap;
        }
        .datepicker {
            order: 3;
            font-size: 0.5em;
            margin: 2% 30%;
        }
        .birthday {
            order: 1;
        }
        label {
            order: 2;
        }
        @media screen and (max-width: 475px) {
            .ui-widget.ui-widget-content {
                width: 60%;
                height: 30%;
            }
        }
        @media screen and (min-width: 375px) {
            #wrapper {
                font-size: 1em;
            }
            .datepicker {
                margin-left: 20%;
            }
            main {
                margin-top: 20%;
            }
        }
        @media screen and (min-width: 475px) {
            #wrapper {
                font-size: 1em;
            }
        }
        @media screen and (min-width: 625px) {
            #wrapper {
                font-size: 2em;
                padding-top: 0;
                margin-top: 0;
            }
            .birthday {
                margin-top: 0;
            }
            main {
                margin-top: 0;
            }
        }
        @media screen and (min-width: 768px) {
            #wrapper {
                font-size: 2em;
            }
            .birthday {
                padding-top: 5%;
            }
            label {
                margin-right: 20%;
            }
        }
        @media screen and (min-width: 1024px) {
            #wrapper > input {
                width: 100%;
                margin-left: 25%;
            }
            label {
                width: 100%;
                margin-left: 0;
                margin-right: 0;
                font-size: 0.9em;
            }
        }
    </style>

    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/angular-ui-router/release/angular-ui-router.js"></script>
    <script src="bower_components/moment/moment.js"></script>

    <title>Math Birthday</title>
</head>
<body ng-app="mathBirthday">
    <main role="content">
        <div ui-view></div>
    </main>

    <script type="text/javascript">
        'use strict';

        angular.module('mathBirthday', ['ui.router'])

            .config(['$stateProvider', '$urlRouterProvider',
                function($stateProvider, $urlRouterProvider) {
                    $urlRouterProvider.otherwise('/home');

                    $stateProvider
                        .state('home', {
                            url: '/home',
                            template: "<div id='wrapper'>" +
                                            "<p class='birthday'>Your next math birthday is your {{mathBirthday || '00'}}-day-old on {{mathBirthday | formatMathBirthday}} date</p>" +
                                            "<label>Please, enter your birthday: </label> <input type='text' ng-model='mathBirthday' datepicker class='datepicker' />" +
                                      "</div>",
                            controllerAs: 'mathBirthday'
                        })
                }]);

        angular.module('mathBirthday').directive("datepicker", function () {
            return {
                restrict: "A",
                require: "ngModel",
                link: function (scope, elem, attrs, ngModelCtrl) {
                    var updateModel = function (dateText) {
                        scope.$apply(function () {
                            ngModelCtrl.$setViewValue(upComingMathBirthday(dateText));
                        });
                    };
                    var options = {
                        dateFormat: "mm/dd/yy",
                        onSelect: function (dateText) {
                            updateModel(dateText);
                        },
                        maxDate: '0',
                        changeYear: true,
                        changeMonth: true,
                        showAnim: 'slideDown'
                    };
                    elem.datepicker(options);

                    var upComingMathBirthday = function (dateText) {
                        var birthday = moment(Date.parse(dateText));
                        var today = moment(Date.now());
                        var currentMathBirthday = Math.pow(10, today.diff(birthday, 'days'));

                        return Math.pow(10, today.diff(birthday, 'days'));
                    };
                }
            }
        });

        angular.module('mathBirthday').filter('formatMathBirthday', function () {
            return function (days) {
                var weeks = days / 7;
                if (isNaN(weeks)) return "";

                return Number.isInteger(weeks)? weeks : Math.round(days / 7) + " around";
            };
        });
    </script>
</body>
</html>